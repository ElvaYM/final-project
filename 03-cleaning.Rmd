# Data transformation
Out of the 16 tables provided by the GHTorrent project, we will use commits, issue comments, and pull request comments. Their original schemas are as follows:
```{r}
dir = "resources/schema/"
tables = c("commits.txt", "issue_comments.txt", "pull_request_comments.txt")
for (i in 1:3){
  filename = paste(dir, tables[i], sep = "")
  file = file(filename)
  lines = paste(c(filename, readLines(file), "-"), "\n")
  for(i in 1:length(lines)){
    if(grepl("Example json:", lines[i])){
      break
    }
    cat(lines[i] |> noquote())
  }
  cat(noquote("\n"))
  close(file)
}
```

We used python to extract data from the bson file. The python script can be found in preprocess/preprocess.py, which will download the raw data set, extract the desired tables, and convert the bson files to csv file. And the extracted bson file, converted csv file will be stored under resources/raw_data and resources/data respectively.

Since the amount of data are still quite large, especially for commits table, which original has over 0.6 million records, we decided to randomly subsample 10 thousand records from each file and removes some unuseful columns.

The commits table has the following columns:
```{r}
library("readr")
dir = "resources/data/"
tables = c("commits.csv", "issue_comments.csv", "pull_request_comments.csv")
commits <- read_csv(paste(dir, tables[1], sep = "")) 
issues <- read_csv(paste(dir, tables[2], sep = "")) 
pull_requests <- read_csv(paste(dir, tables[3], sep = "")) 
commits |> summary() |> print()
```
`Sha` is an unique identifier for the recorder generated by GitHub, `user`, `author`, and `committed` all refer to the user(s) associated with the commit (the different between author and committed can be found [here](https://stackoverflow.com/questions/18750808/difference-between-author-and-committer-in-git#:~:text=The%20author%20is%20the%20person,on%20behalf%20of%20another%20person.){target="_blank"}), `time` is when the commit is committed, `message` is the commit message, `stats` contains the number of total modifications, additions and deletions for this commit, and `url` is the commit's url link.

And the issue_comments table has the following columns:
```{r}
issues |> summary() |> print()
```

And the pull_request_comments table has the following columns:
```{r}
pull_requests |> summary() |> print()
```

The columns for issue_comments and pull_request_comments are exactly the same and the names are quite self-explantory. `id` is an unique identifier, `user_id` is the id for the user who posted the comments, `author_association` is user's association with the repository (can be "NONE", "CONTRIBUTOR", "COLLABORATOR", "MEMBER", and "OWNER"), `created_at` is the time when comment is posted, `body` is the comment's content, `url` is the comment's link, and `repo` is the comments associated repo.
